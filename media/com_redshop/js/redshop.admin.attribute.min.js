jQuery(document).ready(function(){jQuery("#divAttribute").attr("data");jQuery("body").on("click",".icon-expand",function(e){jQuery(this).attr("class","icon-contract btn-collapse zoom")}),jQuery("body").on("click",".icon-contract",function(e){jQuery(this).attr("class","icon-expand btn-collapse zoom")}),jQuery("body").on("click",".btn-collapse",function(e){e.preventDefault();var t=jQuery(this).attr("target-id");jQuery("div[child-of="+t+"]").toggle()}),jQuery("#new_attribute").find("button.btn-add-dependency").click(e=>{e.preventDefault(),addDependencyForElement("#new_attribute")}),jQuery("#new_property").find("button.btn-add-dependency").click(e=>{e.preventDefault(),addDependencyForElement("#new_property")}),jQuery("#new_subproperty").find("button.btn-add-dependency").click(e=>{e.preventDefault(),addDependencyForElement("#new_subproperty")}),jQuery("body").on("click",".icon-minus",function(e){let t,r;if(e.preventDefault(),1==confirm(Joomla.JText._("COM_REDSHOP_CONFIRM_DELETE"))&&"icon-minus btn-functionality zoom"==jQuery(this).attr("class")){r=jQuery(this).parent().parent().parent();redSHOP.RSConfig._("AJAX_TOKEN");(t={type:r.attr("type"),id:r.attr("data-id")})[redSHOP.RSConfig._("AJAX_TOKEN")]=1,jQuery.ajax({method:"POST",url:redSHOP.RSConfig._("SITE_URL")+"administrator/index.php?option=com_ajax&plugin=DeleteElement&group=redshop_product&format=raw",data:t,beforeSend:function(){jQuery("#loader").show()}}).success(function(e){1==e&&(calculateRemainingChild(r,"-"),r.remove()),jQuery("#loader").hide()})}}),jQuery("body").on("click",".btn-ajax",function(e){let t,r,a,n="#"+jQuery(this).attr("target"),i=jQuery(this).attr("type"),d=getAllElements();if(jQuery(n).show(),jQuery(n+" #modal").modal("show"),jQuery("body").find("#new_property").find(".rs-media-cropper-btn").parent().remove(),"attribute"==i)jQuery(n).find("small").html("[ "+Joomla.JText._("COM_REDSHOP_NEW")+" ]"),jQuery(n).find("input[name=attribute_id]").val(0),jQuery(n).find("input[name=attribute_name]").val(""),jQuery(n).find("textarea[name=attribute_description]").val(""),jQuery(n).find("label[id=allow_multiple_selection_0-lbl]").click(),jQuery(n).find("label[id=attribute_required_0-lbl]").click(),jQuery(n).find("label[id=attribute_published_1-lbl]").click(),jQuery(n).find("label[id=hide_0-lbl]").click(),jQuery(n).find("label[id=hide_attribute_price_0-lbl]").click(),jQuery(n).find("label[id=display_type_dropdown-lbl]").click(),jQuery(n).find("input[name=ordering]").val("0"),a=jQuery(n).find("select[data-name=dependency_attribute]"),jQuery(n).find(".data-dependency").html(""),setDependencySelector(a,d);else if("property"==i){jQuery(n).find("input[name=attribute_id]").val(jQuery(this).attr("attribute-id")),jQuery(n).find("input[name=property_id]").val(0),jQuery(n).find("small").html("[ "+Joomla.JText._("COM_REDSHOP_NEW")+" ]"),jQuery(n).find("input[name=property_name]").val(""),jQuery(n).find("input[name=property_number]").val(""),jQuery(n).find("textarea[name=extra_field]").val(""),jQuery(n).find("input[name=property_price]").val("");let e=jQuery(n).find("select[name=oprand]").select2("destroy");e.parent().find("div[class^=chzn-container]").remove(),e.val("S"),e.select2(),jQuery(n).find("label[id=setrequire_selected_0-lbl]").click(),jQuery(n).find("label[id=setdefault_selected_0-lbl]").click(),jQuery(n).find("label[id=setmulti_selected_0-lbl]").click(),jQuery(n).find("label[id=setdisplay_type_dropdown-lbl]").click(),jQuery(n).find("label[id=hide_0-lbl]").click(),dz=jQuery(n).find("div[data-content=propduct-image-lbl]"),dz.html(Joomla.JText._("COM_REDSHOP_IMAGE")),jQuery(n).find(".rs-media-cropper-btn").parent().remove(),jQuery(n).find(".rs-media-remove-btn").click(),a=jQuery(n).find("select[data-name=dependency_attribute]"),jQuery(n).find(".data-dependency").html(""),setDependencySelector(a,d)}else if("subproperty"==i){jQuery(n).find("small").html("[ "+Joomla.JText._("COM_REDSHOP_NEW")+" ]"),jQuery(n).find("input[name=subattribute_color_id]").val(0),t=jQuery(this).attr("property-id"),r=jQuery(this).attr("attribute-id"),jQuery(n).find("input[data-name=attribute_id]").val(r),setDependencySelector(jQuery(n).find("select[name=parent_id]"),d[r][t]),jQuery(n).find("input[name=subattribute_id]").val(t),jQuery(n).find("input[name=subattribute_color_name]").val(""),jQuery(n).find("input[name=subattribute_color_title]").val(""),dz=jQuery(n).find("div[data-content=subproperty-image-lbl]"),dz.html(Joomla.JText._("COM_REDSHOP_IMAGE")),jQuery(n).find(".rs-media-cropper-btn").parent().remove(),jQuery(n).find(".rs-media-remove-btn").click();let e=jQuery(n).find("select[name=oprand]").select2("destroy");e.parent().find("div[class^=chzn-container]").remove(),e.val("S"),e.select2(),jQuery(n).find("input[name=subattribute_color_price]").val(""),jQuery(n).find("label[id=setdefault_selected_0-lbl]").click(),jQuery(n).find("label[id=hide_0-lbl]").click(),jQuery(n).find("textarea[name=extra_field]").val(""),jQuery(n).find("textarea[name=ordering]").val(0),a=jQuery(n).find("select[data-name=dependency_attribute]"),jQuery(n).find(".data-dependency").html(""),setDependencySelector(a,d)}}),jQuery("body").on("click",".btn-functionality",function(e){let t,r,a,n,i,d,l=getAllElements();e.preventDefault(),"icon-edit btn-functionality zoom"==jQuery(this).attr("class")&&(n=(a=jQuery(this).parent().parent().parent()).attr("type"),t=a.attr("data"),t=JSON.parse(atob(t)),r="#new_"+n,"subproperty"==n&&(d=jQuery(this).attr("attribute-id"),i=jQuery(this).attr("property-id"),setDependencySelector(jQuery(r).find("select[name=parent_id]"),l[d][i])),changeModalForUpdate(r,n,t),jQuery(r).show(),jQuery(r+" #modal").modal("show"))}),jQuery("body").keyup(function(e){13!==e.keyCode&&27!==e.keyCode||jQuery(".modal-close").click()}),jQuery(".modal-close").click(function(e){e.preventDefault(),jQuery("#new_attribute").hide(),jQuery("#attribute_result").hide(),jQuery("#new_property").hide(),jQuery("#property_result").hide(),jQuery("#new_subproperty").hide(),jQuery("#subproperty_result").hide()}),jQuery("body").on("click","#save_attribute_top",function(e){e.preventDefault(),ajaxSaveElement("attribute")}),jQuery("body").on("click","#save_attribute",function(e){e.preventDefault(),ajaxSaveElement("attribute")}),jQuery("body").on("click","#save_property_top",function(e){e.preventDefault(),ajaxSaveElement("property")}),jQuery("body").on("click","#save_property",function(e){e.preventDefault(),ajaxSaveElement("property")}),jQuery("body").on("click","#save_subproperty_top",function(e){e.preventDefault(),ajaxSaveElement("subproperty")}),jQuery("body").on("click","#save_subproperty",function(e){e.preventDefault(),ajaxSaveElement("subproperty")})});const getProductId=()=>jQuery("body").find("div#divAttribute").attr("product-id"),updateCommonData=(e,t)=>{if("insert"==t.queryType){let r=getAllElements();switch(e){case"attribute":r[t.attribute_id]={name:t.attribute_name};break;case"property":r[t.attribute_id][t.property_id]={name:t.property_name};break;case"subproperty":r[t.attribute_id][t.subattribute_id][t.subattribute_color_id]={name:t.subattribute_color_name}}r=btoa(JSON.stringify(r)),jQuery("body").find("div[id=divAttribute]").attr("data",r)}},calculateRemainingChild=(e,t)=>{switch(parent=jQuery(e).parent().attr("child-of"),parent=jQuery("#"+parent),btn=parent.find("button.btn-collapse"),no=btn.html(),t){case"-":try{no=parseInt(no),no--,btn.html(no)}catch(e){}break;case"+":try{no=parseInt(no),no++,btn.html(no)}catch(e){}}},loadExistDependency=(e,t)=>{if(null==t)return;let r=decodeDependency(atob(t));if(null!=r&&null!=r)for(let t=0;t<r.length;t++)saveDependencyForElement(e,r[t],t%2)},addDependencyForElement=e=>{let t,r=jQuery(e).find("div[data-id=data-dependency]"),a=!0,n={attribute:{value:jQuery(e).find("select[data-name=dependency_attribute]").val(),text:jQuery(e).find("select[data-name=dependency_attribute] option:selected").html()},property:{value:jQuery(e).find("select[data-name=dependency_property]").val(),text:jQuery(e).find("select[data-name=dependency_property] option:selected").html()},subproperty:{value:jQuery(e).find("select[data-name=dependency_subproperty]").val(),text:jQuery(e).find("select[data-name=dependency_subproperty] option:selected").html()}};null!=n.attribute.value&&""!=n.attribute.value&&null!=n.attribute.value||(a=!1,n.attribute.text=""),null!=n.property.value&&""!=n.property.value&&null!=n.property.value||(n.property.text=""),null!=n.subproperty.value&&""!=n.subproperty.value&&null!=n.subproperty.value||(n.subproperty.text=""),t=r.find("div.row-fluid").length%2,1==a&&saveDependencyForElement(e,n,t)},deleteDependencyForElement=e=>{jQuery(e).parent().parent().remove()},saveDependencyForElement=(e,t,r)=>{let a,n=jQuery(e).find("div[data-id=data-dependency]");a='<div class="row-fluid row'+r+" data-dependency\" data='"+encodeDependency(t)+"'>",a+='<div class="span3">'+t.attribute.text+"</div>",a+='<div class="span3">'+t.property.text+"</div>",a+='<div class="span3">'+t.subproperty.text+"</div>",a+='<div class="span1"><span class="btn btn-danger btn-delete-dependency" onclick="deleteDependencyForElement(this);">x</span></div>',a+="</div>",n.append(a)},encodeDependency=e=>{let t;try{t=JSON.stringify(e)}catch(e){t=""}return t},decodeDependency=e=>{let t;try{t=JSON.parse(e)}catch(e){t=new Array}return t},setDependencySelector=(e,t)=>{if(null==t)return;let r,a=Object.keys(t),n=Object.values(t),d='<option value="">'+Joomla.JText._("COM_REDSHOP_SELECT")+"</option>",l="";for(e.select2("destroy"),i=0;i<a.length;i++)null!=n[i].name&&(d+='<option value="'+a[i]+'">'+n[i].name+"</option>");switch(e.html(d),e.parent().find(".chzn-container").remove(),e.select2(),r=e.val(),l="",jQuery(e).attr("data-name")){case"dependency_attribute":l=jQuery("select[data-name=dependency_property]"),setDependencySelector(l,t[r]);break;case"dependency_property":l=jQuery("select[data-name=dependency_subproperty]"),setDependencySelector(l,t[r])}e.on("change",a=>{switch(r=a.added.id,l="",jQuery(e).attr("data-name")){case"dependency_attribute":l=jQuery("select[data-name=dependency_property]"),setDependencySelector(l,t[r]);break;case"dependency_property":l=jQuery("select[data-name=dependency_subproperty]"),setDependencySelector(l,t[r])}})},getAllElements=()=>{let e=jQuery("body").find("div[id=divAttribute]").attr("data");return JSON.parse(atob(e))},loadElementList=e=>{let t=getAllElements();switch(e){case"0":default:return t}},changeModalForUpdate=(e,t,r)=>{let a,n,i,d,l=getAllElements();switch(t){case"subproperty":jQuery(e).find("small").html("[ "+r.subattribute_color_id+"- "+Joomla.JText._("COM_REDSHOP_EDIT")+" ]"),jQuery(e).find("input[name=subattribute_id]").val(r.subattribute_id),jQuery(e).find("input[name=subattribute_color_id]").val(r.subattribute_color_id),jQuery(e).find("input[name=subattribute_color_name]").val(r.subattribute_color_name),jQuery(e).find("input[name=subattribute_color_title]").val(r.subattribute_color_title),jQuery(e).find("input[name=subattribute_color_number]").val(r.subattribute_color_number),jQuery(e).find("input[name=subattribute_color_price]").val(r.subattribute_color_price),jQuery(e).find("textarea[name=extra_field]").val(r.extra_field),jQuery(e).find("input[name=ordering]").val(r.ordering),parent=jQuery(e).find("select[name=parent_id]").select2("destroy"),parent.parent().find("div[class^=chzn-container]").remove(),parent.val(r.parent_id),parent.select2(),(n=jQuery(e).find("select[name=oprand]").select2("destroy")).parent().find("div[class^=chzn-container]").remove(),n.val(r.oprand),n.select2(),jQuery(e).find("label[id=setdefault_selected_"+r.setdefault_selected+"-lbl]").click(),jQuery(e).find("label[id=subattribute_published_"+r.subattribute_published+"-lbl]").click(),jQuery(e).find("label[id=subattribute_color_hide_"+r.hide+"-lbl]").click(),i=redSHOP.RSConfig._("REDSHOP_FRONT_IMAGES_ABSPATH")+"subcolor/"+r.subattribute_color_image,(a=jQuery(e).find("div[data-content=subproperty-image-lbl]")).html(Joomla.JText._("COM_REDSHOP_IMAGE")+'<div style="padding: 10px"><img src="'+i+'" style="width: 100px" /></div>'),jQuery(e).find(".rs-media-cropper-btn").parent().remove(),jQuery(e).find(".rs-media-remove-btn").click(),d=jQuery(e).find("select[data-name=dependency_attribute]"),setDependencySelector(d,l),jQuery(e).find("div[data-id=data-dependency]").html(""),loadExistDependency(e,r.dependency);break;case"property":jQuery(e).find("input[name=attribute_id]").val(r.attribute_id),jQuery(e).find("input[name=property_id]").val(r.property_id),jQuery(e).find("small").html("[ "+r.property_id+"- "+Joomla.JText._("COM_REDSHOP_EDIT")+" ]"),jQuery(e).find("input[name=property_name]").val(r.property_name),jQuery(e).find("input[name=property_number]").val(r.property_number),jQuery(e).find("textarea[name=extra_field]").val(r.extra_field),jQuery(e).find("input[name=property_price]").val(r.property_price),(n=jQuery(e).find("select[name=oprand]").select2("destroy")).parent().find("div[class^=chzn-container]").remove(),n.val(r.oprand),n.select2(),jQuery(e).find("label[id=property_setrequire_selected_"+r.setrequire_selected+"-lbl]").click(),jQuery(e).find("label[id=property_setdefault_selected_"+r.setdefault_selected+"-lbl]").click(),jQuery(e).find("label[id=setmulti_selected_"+r.setmulti_selected+"-lbl]").click(),jQuery(e).find("label[id=setdisplay_type_"+r.setdisplay_type+"-lbl]").click(),jQuery(e).find("label[id=property_published"+r.property_published+"-lbl]").click(),jQuery(e).find("label[id=property_hide_"+r.hide+"-lbl]").click(),i=redSHOP.RSConfig._("REDSHOP_FRONT_IMAGES_ABSPATH")+"product_attributes/"+r.property_image,(a=jQuery(e).find("div[data-content=propduct-image-lbl]")).html(Joomla.JText._("COM_REDSHOP_IMAGE")+'<div style="padding: 10px"><img src="'+i+'" style="width: 100px" /></div>'),jQuery(e).find(".rs-media-cropper-btn").parent().remove(),jQuery(e).find(".rs-media-remove-btn").click(),d=jQuery(e).find("select[data-name=dependency_attribute]"),setDependencySelector(d,l),jQuery(e).find("div[data-id=data-dependency]").html(""),loadExistDependency(e,r.dependency);break;case"attribute":default:jQuery(e).find("small").html("[ "+r.attribute_id+"- "+Joomla.JText._("COM_REDSHOP_EDIT")+" ]"),jQuery(e).find("input[name=attribute_id]").val(r.attribute_id),jQuery(e).find("input[name=attribute_name]").val(r.attribute_name),jQuery(e).find("textarea[name=attribute_description]").val(r.attribute_description),jQuery(e).find("label[id=allow_multiple_selection_"+r.allow_multiple_selection+"-lbl]").click(),jQuery(e).find("label[id=attribute_required_"+r.attribute_required+"-lbl]").click(),jQuery(e).find("label[id=attribute_published_"+r.attribute_published+"-lbl]").click(),jQuery(e).find("label[id=attribute_hide_"+r.hide+"-lbl]").click(),jQuery(e).find("label[id=hide_attribute_price_"+r.hide_attribute_price+"-lbl]").click(),jQuery(e).find("label[id=display_type_"+r.display_type+"-lbl]").click(),jQuery(e).find("input[name=ordering]").val(r.ordering),jQuery(e).find("input[name=ordering]").val(r.ordering),d=jQuery(e).find("select[data-name=dependency_attribute]"),setDependencySelector(d,l),jQuery(e).find("div[data-id=data-dependency]").html(""),loadExistDependency(e,r.dependency)}},ajaxSaveElement=e=>{let t,r,a;a=getMapInputs("#new_"+e),t=JSON.stringify(a,getCircularReplacer());redSHOP.RSConfig._("AJAX_TOKEN");(r={encodeValues:t,productId:getProductId(),type:e})[redSHOP.RSConfig._("AJAX_TOKEN")]=1,jQuery.ajax({method:"POST",url:redSHOP.RSConfig._("SITE_URL")+"administrator/index.php?option=com_ajax&plugin=SaveElement&group=redshop_product&format=raw",data:r,beforeSend:function(){jQuery("#loader").show()}}).success(function(t){let r,a,n=jQuery("#new_"+e).find("#"+e+"_result");null!=t&&(t=JSON.parse(t)),1==t.result?(n.show().html('<i class="fa fa-check-circle"></i> '+Joomla.JText._("COM_REDSHOP_SAVE_SUCCESSFUL")),a=prepareElementForUpdateList(e,t),r=btoa(JSON.stringify(t)),assignRowAttributeData(a,e,r,t),updateCommonData(e,t)):n.show().html('<i class="fa fa-check-circle"></i> '+Joomla.JText._("COM_REDSHOP_SAVE_FAIL")),jQuery("#loader").hide()})},getMapInputs=e=>{let t=jQuery(e+" :input").map(function(){let e=jQuery(this).attr("type"),t=jQuery(this).attr("name"),r=jQuery(this).val(),a=this.tagName,n={name:t,value:r};if(""!=r)switch(e){case"hidden":case"text":return n;case"checkbox":case"radio":if(this.checked)return n;break;case"select":return n;default:switch(a){case"SELECT":case"TEXTAREA":return n}}}),r=jQuery(e).find("div.data-dependency").map(function(){return{name:"dependency",value:jQuery(this).attr("data")}});for(let e=0;e<r.length;e++)t.push(r[e]);return t},prepareElementForUpdateList=(e,t)=>{let r,a,n,i,d;switch(e){case"subproperty":"insert"==t.queryType?((r=(a=jQuery("div[id=subproperty_id_new_"+t.subattribute_id+"]")).clone()).insertAfter(a),r.show(),r.attr("id","subproperty_id_"+t.subattribute_color_id),r.find(".btn-collapse").attr("target-id","property_id_"+t.subattribute_id),r.attr("style","background-color: yellow")):r=jQuery("div[id=subproperty_id_"+t.subattribute_color_id+"]"),r.attr("dependency",t.dependency);break;case"property":if("insert"==t.queryType){(r=(a=jQuery("div[id=property_id_new_"+t.attribute_id+"]")).clone()).insertAfter(a),r.show(),r.attr("id","property_id_"+t.property_id),r.find(".btn-collapse").attr("target-id","property_id_"+t.property_id),r.attr("style","background-color: yellow"),(n=jQuery("div[data-id=new-subproperty-bar]").first().clone()).find("div.btn-ajax").attr("attribute-id",t.attribute_id),n.find("div.btn-ajax").attr("property-id",t.property_id),n.show(),i=document.createElement("div"),(i=jQuery(i)).attr("class","div_subproperties"),i.attr("child-of","property_id_"+t.property_id),i.append(n),i.insertAfter(r),i.hide();let e=document.createElement("div");(e=jQuery(e)).attr("id","subproperty_id_new_"+t.property_id),e.attr("class","row-fluid row0"),e.attr("style","display:none;"),e.attr("type","subproperty"),d=createSampleColumns(e,"subproperty",t),i.append(e)}else r=jQuery("div[id=property_id_"+t.property_id+"]");r.attr("dependency",t.dependency);break;case"attribute":default:if("insert"==t.queryType){(r=(a=jQuery("div[id=attribute_id_new]")).clone()).insertAfter(a),r.show(),r.attr("id","attribute_id_"+t.attribute_id),r.find(".btn-collapse").attr("target-id","attribute_id_"+t.attribute_id),r.attr("style","background-color: yellow"),(n=jQuery("div[data-id=new-property-bar]").first().clone()).find("div.btn-ajax").attr("attribute-id",t.attribute_id),n.show();let e=document.createElement("div");(e=jQuery(e)).attr("class","div_properties"),e.attr("child-of","attribute_id_"+t.attribute_id),e.append(n),e.insertAfter(r),e.hide(),divSample=document.createElement("div"),divSample=jQuery(divSample),divSample.attr("id","property_id_new_"+t.attribute_id),divSample.attr("class","row-fluid row0"),divSample.attr("style","display:none;"),divSample.attr("type","property"),d=createSampleColumns(divSample,"property",t),e.append(divSample)}else r=jQuery("div[id=attribute_id_"+t.attribute_id+"]");r.attr("dependency",t.dependency)}return r},createSampleColumns=(e,t,r)=>{let a,n,i=[],d=0;switch(t){case"property":i[d]=jQuery(document.createElement("div")),i[d].attr("data-content","property_id"),i[d].attr("class","td span1"),i[d].attr("style","color: darkred"),i[d].html("<i></i>"),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","property_image"),i[d].attr("class","td span1"),(a=jQuery(document.createElement("img"))).attr("src",""),a.attr("style","display:none"),i[d].append(a.clone()),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("class","td span1"),(a=jQuery(document.createElement("a"))).attr("class","joom-box btn btn-small"),a.attr("href",""),a.attr("rel","{handler: 'iframe', size: {x: 950, y: 500}}"),a.html('<img src="'+redSHOP.RSConfig._("SITE_URL")+'media/com_redshop/images/media16.png" alt="" />'),i[d].append(a.clone()),a.html('<img src="'+redSHOP.RSConfig._("SITE_URL")+'media/com_redshop/images/discountmanagmenet16.png" alt="" />'),i[d].append(a.clone()),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","property_name"),i[d].attr("class","td span2"),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","setdefault_selected"),i[d].attr("class","td span1"),(a=jQuery(document.createElement("span"))).attr("class","icon-checkbox-unchecked"),i[d].append(a.clone()),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","oprand"),i[d].attr("class","td span1"),i[d].html("n/a"),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","property_price"),i[d].attr("class","td span1"),i[d].html("0"),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","setrequire_selected"),i[d].attr("class","td span1"),(a=jQuery(document.createElement("span"))).attr("class","icon-checkbox-unchecked"),i[d].append(a.clone()),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","property_published"),i[d].attr("class","td span1"),(a=jQuery(document.createElement("span"))).attr("class","icon-checkbox-unchecked"),i[d].append(a.clone()),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","setdisplay_type"),i[d].attr("class","td span1"),i[d].html("dropdown"),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","hide"),i[d].attr("class","td span1"),(a=jQuery(document.createElement("span"))).attr("class","icon-checkbox-unchecked"),i[d].append(a.clone()),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),(a=jQuery(document.createElement("button"))).attr("class","btn btn-collapse"),a.attr("target-id","propery_id_"+r.property_id),a.attr("style","background-color: darkgreen; color: white;"),a.html("0"),i[d].append(a.clone()),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("class","td span1"),(a=jQuery(document.createElement("div"))).attr("class","btn-edit-inrow"),(n=jQuery(document.createElement("span"))).attr("class","icon-minus btn-functionality zoom"),a.append(n.clone()),n.attr("class","icon-edit btn-functionality zoom"),n.attr("attribute-id",r.attribute_id),n.attr("property-id",r.property_id),a.prepend(n.clone()),n.attr("class","icon-expand btn-collapse zoom"),n.attr("target-id","propery_id_"+r.property_id),a.prepend(n.clone()),i[d].append(a),e.append(i[d]),d++;break;case"subproperty":i[d]=jQuery(document.createElement("div")),i[d].attr("data-content","subattribute_color_id"),i[d].attr("class","td span1"),i[d].attr("style","color: darkgreen"),i[d].html("<i></i>"),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","subattribute_color_image"),i[d].attr("class","td span1"),(a=jQuery(document.createElement("img"))).attr("src",""),a.attr("style","display:none"),i[d].append(a.clone()),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("class","td span1"),(a=jQuery(document.createElement("a"))).attr("class","joom-box btn btn-small"),a.attr("href",""),a.attr("rel","{handler: 'iframe', size: {x: 950, y: 500}}"),a.html('<img src="'+redSHOP.RSConfig._("SITE_URL")+'media/com_redshop/images/media16.png" alt="" />'),i[d].append(a.clone()),a.html('<img src="'+redSHOP.RSConfig._("SITE_URL")+'media/com_redshop/images/discountmanagmenet16.png" alt="" />'),i[d].append(a.clone()),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","subattribute_color_name"),i[d].attr("class","td span2"),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","oprand"),i[d].attr("class","td span1"),i[d].html("n/a"),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","subattribute_color_price"),i[d].attr("class","td span1"),i[d].html("0"),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","setdisplay_type"),i[d].attr("class","td span1"),i[d].html("dropdown"),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","setdefault_selected"),i[d].attr("class","td span1"),(a=jQuery(document.createElement("span"))).attr("class","icon-checkbox-unchecked"),i[d].append(a.clone()),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","subattribute_published"),i[d].attr("class","td span1"),(a=jQuery(document.createElement("span"))).attr("class","icon-checkbox-unchecked"),i[d].append(a.clone()),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("data-content","hide"),i[d].attr("class","td span1"),(a=jQuery(document.createElement("span"))).attr("class","icon-checkbox-unchecked"),i[d].append(a.clone()),e.append(i[d]),i[++d]=jQuery(document.createElement("div")),i[d].attr("class","td span1"),(a=jQuery(document.createElement("div"))).attr("class","btn-edit-inrow"),(n=jQuery(document.createElement("span"))).attr("class","icon-minus btn-functionality zoom"),a.append(n.clone()),n.attr("class","icon-edit btn-functionality zoom"),n.attr("attribute-id",r.attribute_id),n.attr("property-id",r.property_id),a.prepend(n.clone()),i[d].append(a),e.append(i[d]),d++}},assignRowAttributeData=(e,t,r,a)=>{let n,i;switch(e.attr("data",r),e.attr("dependency",a.dependency),"insert"==a.queryType&&calculateRemainingChild(e,"+"),t){case"subproperty":null!=a.subattribute_color_image&&e.find("div[data-content=subattribute_color_image]").find("img").show().attr("src",redSHOP.RSConfig._("REDSHOP_FRONT_IMAGES_ABSPATH")+"subcolor/"+a.subattribute_color_image);let d=e.find("span.icon-edit").attr("attribute-id");null==d&&(d=jQuery("div.div_subproperties").find("div[target=new_subproperty]").attr("attribute-id"),e.find("span.icon-edit").attr("attribute-id",d)),e.attr("data-id",a.subattribute_color_id),e.find("span.icon-edit").attr("property-id",a.subattribute_id),e.find("div[data-content=subattribute_color_id]").html("<b>"+a.subattribute_color_id+"</b>"),e.find("div[data-content=subattribute_color_name]").html(a.subattribute_color_name),e.find("div[data-content=oprand]").html(a.oprand),e.find("div[data-content=subattribute_color_price]").html(a.subattribute_color_price),e.find("div[data-content=ordering]").html(a.ordering),changeStickState(e,"setdefault_selected",a.setdefault_selected),changeStickState(e,"subattribute_published",a.subattribute_published),changeStickState(e,"hide",a.hide),e.css("background-color","#ffcd9e"),n=jQuery("#new_"+t),i=redSHOP.RSConfig._("REDSHOP_FRONT_IMAGES_ABSPATH")+"subcolor/"+a.subattribute_color_image,jQuery(n).find(".rs-media-cropper-btn").parent().remove(),jQuery(n).find(".rs-media-remove-btn").click(),jQuery(n).find("div[data-content=propduct-image-lbl]").find("img").attr("src",i),mediaBox=e.find("a.joom-box").first(),priceBox=e.find("a.joom-box").last(),mediaBox.attr("href",redSHOP.RSConfig._("SITE_URL")+"administrator/index.php?tmpl=component&option=com_redshop&view=media&section_id="+a.subattribute_color_id+"&showbuttons=1&media_section=subproperty"),priceBox.attr("href",redSHOP.RSConfig._("SITE_URL")+"administrator/index.php?tmpl=component&option=com_redshop&view=attributeprices&section_id="+a.subattribute_color_id+"&cid="+getProductId()+"&section=subproperty"),mediaBox.click(function(e){e.preventDefault(),SqueezeBox.assign(this,{handler:"iframe",size:{x:950,y:500}})}),priceBox.click(function(e){e.preventDefault(),SqueezeBox.assign(this,{handler:"iframe",size:{x:950,y:500}})});break;case"property":null!=a.property_image&&e.find("div[data-content=property_image]").find("img").show().attr("src",redSHOP.RSConfig._("REDSHOP_FRONT_IMAGES_ABSPATH")+"product_attributes/"+a.property_image),e.attr("data-id",a.property_id),e.find("div[data-content=property_id]").html("<b>"+a.property_id+"</b>"),e.find("div[data-content=property_name]").html(a.property_name),e.find("div[data-content=property_number]").html(Joomla.JText._("COM_REDSHOP_PROPERTY_NUMBER")+":"+a.property_number),e.find("div[data-content=setdisplay_type]").html(a.setdisplay_type),e.find("div[data-content=oprand]").html(a.oprand),e.find("div[data-content=property_price]").html(a.property_price),e.find("div[data-content=ordering]").html(a.ordering),changeStickState(e,"setdefault_selected",a.setdefault_selected),changeStickState(e,"setrequire_selected",a.setrequire_selected),changeStickState(e,"property_published",a.property_published),changeStickState(e,"setmulti_selected",a.setmulti_selected),changeStickState(e,"hide",a.hide),e.css("background-color","#ffcd9e"),n=jQuery("#new_"+t),i=redSHOP.RSConfig._("REDSHOP_FRONT_IMAGES_ABSPATH")+"product_attributes/"+a.property_image,jQuery(n).find(".rs-media-cropper-btn").parent().remove(),jQuery(n).find(".rs-media-remove-btn").click(),jQuery(n).find("div[data-content=propduct-image-lbl]").find("img").attr("src",i),mediaBox=e.find("a.joom-box").first(),priceBox=e.find("a.joom-box").last(),mediaBox.attr("href",redSHOP.RSConfig._("SITE_URL")+"administrator/index.php?tmpl=component&option=com_redshop&view=media&section_id="+a.property_id+"&showbuttons=1&media_section=property"),priceBox.attr("href",redSHOP.RSConfig._("SITE_URL")+"administrator/index.php?tmpl=component&option=com_redshop&view=attributeprices&section_id="+a.property_id+"&cid="+getProductId()+"&section=property"),mediaBox.click(function(e){e.preventDefault(),SqueezeBox.assign(this,{handler:"iframe",size:{x:950,y:500}})}),priceBox.click(function(e){e.preventDefault(),SqueezeBox.assign(this,{handler:"iframe",size:{x:950,y:500}})});break;case"attribute":default:e.attr("data-id",a.attribute_id),e.attr("dependency",a.dependency),e.find("div[data-content=attribute_id]").html("<b>"+a.attribute_id+"</b>"),e.find("div[data-content=attribute_name]").html(a.attribute_name),e.find("div[data-content=display_type]").html(a.display_type),e.find("div[data-content=ordering]").html(a.ordering),changeStickState(e,"attribute_required",a.attribute_required),changeStickState(e,"allow_multiple_selection",a.allow_multiple_selection),changeStickState(e,"attribute_published",a.attribute_published),changeStickState(e,"hide",a.hide),e.css("background-color","#ffcd9e")}},changeStickState=(e,t,r)=>{"1"==r?e.find("div[data-content="+t+"]").first().find("span").attr("class","icon-checkbox-checked"):e.find("div[data-content="+t+"]").first().find("span").attr("class","icon-checkbox-unchecked")},getCircularReplacer=()=>{const e=new WeakSet;return(t,r)=>{if("object"==typeof r&&null!==r){if(e.has(r))return;e.add(r)}return r}};